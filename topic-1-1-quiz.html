<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AP CSP - Topic 1.1: Collaboration Quiz</title>
  <style>
    :root {
      --primary: #4a2c8f;
      --primary-light: #6b45c2;
      --primary-dark: #36206a;
      --secondary: #ff7b00;
      --secondary-light: #ff9a3f;
      --secondary-dark: #cc6200;
      --white: #ffffff;
      --light: #f5f5f5;
      --gray: #e0e0e0;
      --dark: #333333;
      --success: #28a745;
      --success-light: #d4edda;
      --success-border: #c3e6cb;
      --danger: #dc3545;
      --danger-light: #f8d7da;
      --danger-border: #f5c6cb;
      --warning: #ffc107;
      --warning-light: #fff3cd;
      --info: #17a2b8;
      --info-light: #d1ecf1;
      --info-border: #bee5eb;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      line-height: 1.6;
      color: var(--dark);
      background-color: var(--light);
      min-height: 100vh;
    }

    .navbar {
      background-color: var(--primary);
      color: var(--white);
      padding: 15px 30px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 1000;
    }

    .navbar-logo {
      font-size: 1.4rem;
      font-weight: 700;
    }

    .navbar-actions {
      display: flex;
      gap: 15px;
    }

    .navbar-btn {
      background-color: transparent;
      border: 2px solid var(--white);
      color: var(--white);
      padding: 8px 16px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.2s ease;
      text-decoration: none;
    }

    .navbar-btn:hover {
      background-color: var(--white);
      color: var(--primary);
    }

    .container {
      max-width: 960px;
      margin: 100px auto 50px;
      padding: 20px;
    }

    .quiz-header {
      background-color: var(--white);
      border-radius: 12px;
      padding: 30px;
      margin-bottom: 30px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
      text-align: center;
      animation: fadeIn 0.6s ease;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .quiz-title {
      font-size: 2rem;
      font-weight: 700;
      color: var(--primary);
      margin-bottom: 10px;
    }

    .quiz-description {
      color: var(--dark);
      margin-bottom: 20px;
    }

    .quiz-info {
      display: flex;
      justify-content: center;
      gap: 30px;
      margin-bottom: 20px;
    }

    .info-item {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .info-icon {
      background-color: var(--primary-light);
      color: var(--white);
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
      font-weight: bold;
    }

    .info-text {
      font-size: 0.95rem;
    }

    .info-text strong {
      display: block;
      color: var(--primary-dark);
    }

    .timer-container {
      background-color: var(--primary-light);
      color: var(--white);
      padding: 10px 20px;
      border-radius: 8px;
      display: inline-block;
      font-size: 1.2rem;
      font-weight: bold;
      margin-top: 10px;
    }

    .stats-container {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      background-color: var(--white);
      padding: 15px 20px;
      border-radius: 12px;
      box-shadow: 0 3px 10px rgba(0,0,0,0.1);
      animation: fadeIn 0.6s ease;
      animation-delay: 0.1s;
      animation-fill-mode: both;
    }

    .progress-container {
      flex-grow: 1;
      margin-right: 20px;
    }

    .question-counter {
      font-size: 0.95rem;
      font-weight: 600;
      margin-bottom: 8px;
      color: var(--primary-dark);
    }

    .progress-bar {
      height: 10px;
      background-color: var(--gray);
      border-radius: 5px;
      overflow: hidden;
    }

    .progress {
      height: 100%;
      background-color: var(--primary);
      width: 0%;
      transition: width 0.3s ease;
    }

    .quiz-content {
      background-color: var(--white);
      border-radius: 12px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
      padding: 30px;
      margin-bottom: 30px;
      animation: fadeIn 0.6s ease;
      animation-delay: 0.2s;
      animation-fill-mode: both;
    }

    .question-container {
      margin-bottom: 30px;
    }

    .question {
      font-size: 1.2rem;
      font-weight: 600;
      color: var(--primary-dark);
      margin-bottom: 20px;
    }

    .options {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .option {
      background-color: var(--light);
      border: 2px solid var(--gray);
      border-radius: 8px;
      padding: 15px;
      cursor: pointer;
      transition: all 0.2s ease;
      position: relative;
      display: flex;
      align-items: center;
    }

    .option:hover {
      background-color: #efefef;
      transform: translateX(5px);
    }

    .option input[type="checkbox"],
    .option input[type="radio"] {
      margin-right: 15px;
      transform: scale(1.2);
    }

    .option-label {
      flex-grow: 1;
    }

    .option-selected {
      border-color: var(--primary);
      background-color: var(--primary-light);
      color: var(--white);
    }

    .feedback {
      margin-top: 20px;
      padding: 15px;
      border-radius: 8px;
      display: none;
    }

    .feedback.correct {
      background-color: var(--success-light);
      border: 1px solid var(--success-border);
      color: var(--success);
    }

    .feedback.incorrect {
      background-color: var(--danger-light);
      border: 1px solid var(--danger-border);
      color: var(--danger);
    }

    .explanation {
      margin-top: 10px;
      font-style: italic;
    }

    .paragraph-question {
      margin-bottom: 20px;
    }

    .paragraph-answer {
      width: 100%;
      min-height: 150px;
      padding: 15px;
      border: 2px solid var(--gray);
      border-radius: 8px;
      font-family: inherit;
      font-size: 1rem;
      resize: vertical;
      transition: border-color 0.2s ease;
    }

    .paragraph-answer:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(74, 44, 143, 0.1);
    }

    .character-count {
      text-align: right;
      font-size: 0.9rem;
      color: #666;
      margin-top: 5px;
    }

    .navigation {
      display: flex;
      justify-content: space-between;
      margin-top: 30px;
      padding-top: 20px;
      border-top: 1px solid var(--gray);
    }

    .btn {
      display: inline-block;
      background-color: var(--primary);
      color: var(--white);
      border: none;
      padding: 12px 25px;
      font-size: 1rem;
      font-weight: 600;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .btn:hover {
      background-color: var(--primary-light);
      transform: translateY(-2px);
      box-shadow: 0 5px 10px rgba(0,0,0,0.1);
    }

    .btn:active {
      transform: translateY(1px);
    }

    .btn:disabled {
      background-color: var(--gray);
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    .btn-submit {
      background-color: var(--secondary);
    }

    .btn-submit:hover {
      background-color: var(--secondary-light);
    }

    .results {
      background-color: var(--white);
      border-radius: 12px;
      padding: 30px;
      text-align: center;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
      display: none;
      animation: fadeIn 0.6s ease;
    }

    .results-header {
      margin-bottom: 30px;
    }

    .results-title {
      font-size: 2rem;
      font-weight: 700;
      color: var(--primary);
      margin-bottom: 10px;
    }

    .results-subtitle {
      color: var(--dark);
    }

    .score-container {
      background-color: var(--light);
      border-radius: 50%;
      width: 180px;
      height: 180px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      margin: 0 auto 30px;
      border: 8px solid var(--primary-light);
    }

    .score-value {
      font-size: 2.5rem;
      font-weight: 700;
      color: var(--primary-dark);
    }

    .score-text {
      font-size: 1.1rem;
      color: var(--primary-dark);
    }

    .score-details {
      display: flex;
      justify-content: center;
      gap: 30px;
      margin-bottom: 30px;
      flex-wrap: wrap;
    }

    .detail-item {
      background-color: var(--light);
      padding: 15px 25px;
      border-radius: 10px;
      text-align: center;
      min-width: 140px;
    }

    .detail-value {
      font-size: 1.8rem;
      font-weight: 700;
      color: var(--primary);
      margin-bottom: 5px;
    }

    .detail-label {
      font-size: 0.9rem;
      color: #666;
    }

    .action-buttons {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-top: 30px;
    }

    .feedback-section {
      margin-top: 40px;
      text-align: left;
    }

    .feedback-header {
      font-size: 1.3rem;
      font-weight: 700;
      color: var(--primary-dark);
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 2px solid var(--primary-light);
    }

    .feedback-item {
      margin-bottom: 30px;
      padding-bottom: 20px;
      border-bottom: 1px solid var(--gray);
    }

    .feedback-question {
      font-weight: 600;
      margin-bottom: 10px;
      color: var(--primary-dark);
    }

    .feedback-answer {
      margin-bottom: 15px;
    }

    .feedback-explanation {
      padding: 15px;
      border-radius: 8px;
      font-style: italic;
    }

    .feedback-correct {
      background-color: var(--success-light);
      color: var(--success);
    }

    .feedback-incorrect {
      background-color: var(--danger-light);
      color: var(--danger);
    }

    /* Media queries for responsiveness */
    @media (max-width: 768px) {
      .container {
        padding: 15px;
        margin-top: 80px;
      }
      
      .navbar {
        padding: 12px 20px;
      }
      
      .quiz-header, .quiz-content, .results {
        padding: 20px;
      }
      
      .quiz-title {
        font-size: 1.6rem;
      }
      
      .quiz-info {
        flex-direction: column;
        gap: 15px;
        align-items: center;
      }
      
      .score-container {
        width: 150px;
        height: 150px;
      }
      
      .score-value {
        font-size: 2rem;
      }
      
      .navigation {
        flex-direction: column;
        gap: 15px;
      }
      
      .btn {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <nav class="navbar">
    <div class="navbar-logo">AP CSP Quiz Platform</div>
    <div class="navbar-actions">
      <a href="topic-1-1.html" class="navbar-btn">Back to Topic 1.1</a>
      <a href="main-menu.html" class="navbar-btn">Main Menu</a>
      <button class="navbar-btn" id="logout-btn">Logout</button>
    </div>
  </nav>

  <div class="container">
    <!-- Quiz Header -->
    <div class="quiz-header">
      <h1 class="quiz-title">Topic 1.1: Collaboration Quiz</h1>
      <p class="quiz-description">Test your understanding of collaboration in computing, including diverse perspectives, collaboration strategies, and tools.</p>
      
      <div class="quiz-info">
        <div class="info-item">
          <div class="info-icon">Q</div>
          <div class="info-text">
            <strong>20 Questions</strong>
            16 single answer, 4 dual answer
          </div>
        </div>
        <div class="info-item">
          <div class="info-icon">T</div>
          <div class="info-text">
            <strong>Time Limit</strong>
            30 minutes
          </div>
        </div>
        <div class="info-item">
          <div class="info-icon">P</div>
          <div class="info-text">
            <strong>Passing Score</strong>
            70% or higher
          </div>
        </div>
      </div>
      
      <div class="timer-container" id="timer">Time: 30:00</div>
    </div>
    
    <!-- Quiz Progress -->
    <div class="stats-container">
      <div class="progress-container">
        <div class="question-counter">Question <span id="current-question">1</span> of <span id="total-questions">20</span></div>
        <div class="progress-bar">
          <div class="progress" id="progress-bar"></div>
        </div>
      </div>
    </div>
    
    <!-- Quiz Content -->
    <div class="quiz-content" id="quiz-container">
      <!-- Single-choice question template -->
      <div class="question-container" id="q1">
        <div class="question">1. Why is collaboration important in developing computing innovations?</div>
        <div class="options">
          <label class="option">
            <input type="radio" name="q1" value="a">
            <span class="option-label">It reduces development time by splitting up the work</span>
          </label>
          <label class="option">
            <input type="radio" name="q1" value="b">
            <span class="option-label">It allows only expert programmers to contribute to important parts of the project</span>
          </label>
          <label class="option">
            <input type="radio" name="q1" value="c">
            <span class="option-label">It produces a computing innovation that reflects diverse talents and perspectives</span>
          </label>
          <label class="option">
            <input type="radio" name="q1" value="d">
            <span class="option-label">It ensures that the most experienced programmer makes all important decisions</span>
          </label>
        </div>
        <div class="feedback" id="feedback1"></div>
      </div>
      
      <!-- Multiple-choice (select exactly 2) question template -->
      <div class="question-container" id="q2" style="display: none;">
        <div class="question">2. Which TWO of the following are benefits of pair programming? (Select exactly TWO)</div>
        <div class="options">
          <label class="option">
            <input type="checkbox" name="q2" value="a">
            <span class="option-label">Immediate feedback on code being written</span>
          </label>
          <label class="option">
            <input type="checkbox" name="q2" value="b">
            <span class="option-label">Knowledge sharing between programmers</span>
          </label>
          <label class="option">
            <input type="checkbox" name="q2" value="c">
            <span class="option-label">Elimination of the need for program testing</span>
          </label>
          <label class="option">
            <input type="checkbox" name="q2" value="d">
            <span class="option-label">Reduced likelihood of simple errors going unnoticed</span>
          </label>
        </div>
        <div class="feedback" id="feedback2"></div>
      </div>
      
      <!-- Single-choice question template -->
      <div class="question-container" id="q3" style="display: none;">
        <div class="question">3. How do diverse perspectives contribute to the development of computing innovations?</div>
        <div class="options">
          <label class="option">
            <input type="radio" name="q3" value="a">
            <span class="option-label">By ensuring only expert programmers make important decisions</span>
          </label>
          <label class="option">
            <input type="radio" name="q3" value="b">
            <span class="option-label">By creating more visually appealing user interfaces</span>
          </label>
          <label class="option">
            <input type="radio" name="q3" value="c">
            <span class="option-label">By identifying and addressing potential biases in the innovation</span>
          </label>
          <label class="option">
            <input type="radio" name="q3" value="d">
            <span class="option-label">By making the development process take longer</span>
          </label>
        </div>
        <div class="feedback" id="feedback3"></div>
      </div>
      
      <!-- Navigation -->
      <div class="navigation">
        <button id="prev-btn" class="btn" disabled>Previous</button>
        <button id="submit-btn" class="btn btn-submit">Submit Answer</button>
        <button id="next-btn" class="btn" disabled>Next</button>
      </div>
    </div>
    
    <!-- Results Section (Initially Hidden) -->
    <div class="results" id="results">
      <div class="results-header">
        <h2 class="results-title">Quiz Complete!</h2>
        <p class="results-subtitle">Here's how you performed on the Topic 1.1 Collaboration Quiz</p>
      </div>
      
      <div class="score-container">
        <div class="score-value" id="score-percentage">85%</div>
        <div class="score-text">Your Score</div>
      </div>
      
      <div class="score-details">
        <div class="detail-item">
          <div class="detail-value" id="score-points">17/20</div>
          <div class="detail-label">Questions Correct</div>
        </div>
        <div class="detail-item">
          <div class="detail-value" id="score-time">23:45</div>
          <div class="detail-label">Time Taken</div>
        </div>
        <div class="detail-item">
          <div class="detail-value" id="score-result">PASS</div>
          <div class="detail-label">Result</div>
        </div>
      </div>
      
      <div class="action-buttons">
        <a href="topic-1-1.html" class="btn">Back to Topic 1.1</a>
        <button id="review-btn" class="btn">Review Answers</button>
        <button id="retake-btn" class="btn btn-submit">Retake Quiz</button>
      </div>
      
      <!-- Feedback Section (Initially Hidden) -->
      <div class="feedback-section" id="feedback-section" style="display: none;">
        <h3 class="feedback-header">Question Review</h3>
        
        <!-- Feedback items will be dynamically generated here -->
      </div>
    </div>
  </div>

  <script>
    // Quiz Configuration
    const quizConfig = {
      timeLimit: 30 * 60, // 30 minutes in seconds
      passingScore: 70, // 70% to pass
      questions: [
        // Question 1: Single-choice
        {
          type: 'single',
          correctAnswer: 'c',
          explanation: 'Collaboration produces a computing innovation that reflects the diversity of talents and perspectives of those who designed it. This is a key concept in the Creative Development Big Idea (CRD-1.A.3).'
        },
        // Question 2: Multiple-choice (select exactly 2)
        {
          type: 'multiple',
          correctAnswers: ['a', 'b'],
          explanation: 'Pair programming provides immediate feedback and facilitates knowledge sharing between programmers. While it can help reduce errors, it does not eliminate the need for testing, which is a separate part of the development process (CRD-1.B.2).'
        },
        // Question 3: Single-choice
        {
          type: 'single',
          correctAnswer: 'c',
          explanation: 'Diverse perspectives help identify and address potential biases in computing innovations. When people with different backgrounds, experiences, and viewpoints collaborate, they can spot issues that a more homogeneous team might miss (CRD-1.A.5).'
        },
        // Question 4: Single-choice
        {
          type: 'single',
          correctAnswer: 'b',
          explanation: 'Version control systems like Git allow multiple developers to work on the same codebase simultaneously without overwriting each other\'s changes, facilitating effective collaboration among team members (CRD-1.C).'
        },
        // Question 5: Single-choice
        {
          type: 'single',
          correctAnswer: 'a',
          explanation: 'GitHub is a platform built around Git that adds features like issue tracking, pull requests, and code review capabilities, making it a valuable collaboration tool for software development teams (CRD-1.C).'
        },
        // Question 6: Multiple-choice (select exactly 2)
        {
          type: 'multiple',
          correctAnswers: ['c', 'd'],
          explanation: 'Two effective ways to include diverse perspectives in a computing innovation are consulting with potential users from different backgrounds and forming a development team with members from diverse backgrounds. Both approaches help ensure the innovation meets the needs of a wide range of users (CRD-1.B).'
        },
        // Question 7: Single-choice
        {
          type: 'single',
          correctAnswer: 'd',
          explanation: 'In an agile development methodology, team members regularly communicate and collaborate through practices like daily stand-up meetings, where each person shares what they're working on and any challenges they're facing (CRD-1.C).'
        },
        // Question 8: Single-choice
        {
          type: 'single',
          correctAnswer: 'c',
          explanation: 'A code review is a process where peers systematically examine another developer's code to identify bugs, ensure code quality, and share knowledge, which enhances collaboration and improves the overall quality of the computing innovation (CRD-1.C.1).'
        },
        // Question 9: Single-choice
        {
          type: 'single',
          correctAnswer: 'b',
          explanation: 'A key benefit of diverse teams is their ability to identify and address potential biases in a computing innovation, which helps ensure the innovation works well for a wide range of users and use cases (CRD-1.B.1).'
        },
        // Question 10: Multiple-choice (select exactly 2)
        {
          type: 'multiple',
          correctAnswers: ['a', 'd'],
          explanation: 'Two challenges that collaboration can help overcome are the increased complexity of modern software development and the need to consider diverse user perspectives and needs. By bringing together multiple viewpoints and skill sets, collaborative teams can tackle these challenges more effectively (CRD-1.A).'
        },
        // Additional questions would be filled in for a complete assessment...
      ],
      totalQuestions: 20 // Total number of questions (showing 10 as examples)
    };
    
    // Quiz State
    let quizState = {
      currentQuestion: 1,
      timeRemaining: quizConfig.timeLimit,
      timer: null,
      answers: Array(quizConfig.totalQuestions).fill(null),
      completed: Array(quizConfig.totalQuestions).fill(false),
      score: 0
    };
    
    // DOM Elements
    const currentQuestionEl = document.getElementById('current-question');
    const totalQuestionsEl = document.getElementById('total-questions');
    const progressBarEl = document.getElementById('progress-bar');
    const timerEl = document.getElementById('timer');
    const prevBtn = document.getElementById('prev-btn');
    const nextBtn = document.getElementById('next-btn');
    const submitBtn = document.getElementById('submit-btn');
    const quizContainer = document.getElementById('quiz-container');
    const resultsContainer = document.getElementById('results');
    const feedbackSection = document.getElementById('feedback-section');
    const reviewBtn = document.getElementById('review-btn');
    const retakeBtn = document.getElementById('retake-btn');
    
    // For this demo, we'll only show the first 3 questions
    // In a real application, you would have all 20 questions defined in quizConfig.questions
    
    // Initialize Quiz
    function initQuiz() {
      // Set total questions
      totalQuestionsEl.textContent = quizConfig.totalQuestions;
      
      // Update progress
      updateProgress();
      
      // Start timer
      startTimer();
      
      // Add listeners to paragraph answers for character counting
      document.querySelectorAll('.paragraph-answer').forEach(textarea => {
        const id = textarea.id;
        const countId = id.replace('answer', 'char-count');
        
        textarea.addEventListener('input', function() {
          document.getElementById(countId).textContent = this.value.length;
        });
      });
      
      // Add event listeners
      prevBtn.addEventListener('click', goToPreviousQuestion);
      nextBtn.addEventListener('click', goToNextQuestion);
      submitBtn.addEventListener('click', submitAnswer);
      reviewBtn.addEventListener('click', toggleReview);
      retakeBtn.addEventListener('click', retakeQuiz);
      document.getElementById('logout-btn').addEventListener('click', logout);
      
      // Make each option clickable
      document.querySelectorAll('.option').forEach(option => {
        option.addEventListener('click', function(e) {
          // If clicked on the label part, but not directly on the input
          if (e.target.classList.contains('option-label')) {
            // Find the input within this option and click it
            const input = this.querySelector('input');
            input.click();
          }
        });
      });
      
      // Add input change listeners
      document.querySelectorAll('input[type="radio"], input[type="checkbox"]').forEach(input => {
        input.addEventListener('change', function() {
          // Handle styling for radio buttons
          if (this.type === 'radio') {
            // Remove selected class from all options in this group
            document.querySelectorAll(`input[name="${this.name}"]`).forEach(radio => {
              radio.closest('.option').classList.remove('option-selected');
            });
            
            // Add selected class to this option
            this.closest('.option').classList.add('option-selected');
          }
          // Handle styling for checkboxes
          else if (this.type === 'checkbox') {
            if (this.checked) {
              this.closest('.option').classList.add('option-selected');
            } else {
              this.closest('.option').classList.remove('option-selected');
            }
          }
          
          // Enable submit button when an option is selected
          submitBtn.disabled = false;
        });
      });
    }
    
    // Timer Functions
    function startTimer() {
      updateTimerDisplay();
      quizState.timer = setInterval(updateTimer, 1000);
    }
    
    function updateTimer() {
      quizState.timeRemaining--;
      updateTimerDisplay();
      
      if (quizState.timeRemaining <= 0) {
        clearInterval(quizState.timer);
        finishQuiz();
      }
    }
    
    function updateTimerDisplay() {
      const minutes = Math.floor(quizState.timeRemaining / 60);
      const seconds = quizState.timeRemaining % 60;
      timerEl.textContent = `Time: ${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
      
      // Add warning colors
      if (quizState.timeRemaining <= 300) { // 5 minutes or less
        timerEl.style.backgroundColor = '#dc3545';
      } else if (quizState.timeRemaining <= 600) { // 10 minutes or less
        timerEl.style.backgroundColor = '#ffc107';
        timerEl.style.color = '#333';
      }
    }
    
    // Navigation Functions
    function goToPreviousQuestion() {
      if (quizState.currentQuestion > 1) {
        quizState.currentQuestion--;
        showQuestion(quizState.currentQuestion);
        updateProgress();
      }
    }
    
    function goToNextQuestion() {
      if (quizState.currentQuestion < quizConfig.totalQuestions) {
        quizState.currentQuestion++;
        showQuestion(quizState.currentQuestion);
        updateProgress();
      } else {
        finishQuiz();
      }
    }
    
    function showQuestion(questionNumber) {
      // Hide all questions
      document.querySelectorAll('.question-container').forEach(q => {
        q.style.display = 'none';
      });
      
      // Show current question
      const questionEl = document.getElementById(`q${questionNumber}`);
      if (questionEl) {
        questionEl.style.display = 'block';
      } else {
        // In a real app, you would generate the question dynamically here
        // For this demo, we'll show a placeholder message for questions beyond our examples
        generatePlaceholderQuestion(questionNumber);
      }
      
      // Update current question number
      currentQuestionEl.textContent = questionNumber;
      
      // Update navigation buttons
      prevBtn.disabled = questionNumber === 1;
      nextBtn.disabled = !quizState.completed[questionNumber - 1];
      
      // Reset submit button state
      if (quizState.completed[questionNumber - 1]) {
        submitBtn.disabled = true;
      } else {
        // Check if any option is selected
        const selectedOption = document.querySelector(`#q${questionNumber} input:checked`);
        submitBtn.disabled = !selectedOption && !document.querySelector(`#answer${questionNumber}:not(:empty)`);
      }
    }
    
    function generatePlaceholderQuestion(questionNumber) {
      // This is just for the demo - in a real app, you would have all questions defined
      const questionHTML = `
        <div class="question-container" id="q${questionNumber}">
          <div class="question">${questionNumber}. This is a placeholder for question ${questionNumber}</div>
          <div class="options">
            ${questionNumber <= 15 ? `
              <label class="option">
                <input type="radio" name="q${questionNumber}" value="a">
                <span class="option-label">Option A</span>
              </label>
              <label class="option">
                <input type="radio" name="q${questionNumber}" value="b">
                <span class="option-label">Option B</span>
              </label>
              <label class="option">
                <input type="radio" name="q${questionNumber}" value="c">
                <span class="option-label">Option C</span>
              </label>
              <label class="option">
                <input type="radio" name="q${questionNumber}" value="d">
                <span class="option-label">Option D</span>
              </label>
            ` : `
              <div class="paragraph-question">
                <textarea class="paragraph-answer" id="answer${questionNumber}" rows="6" maxlength="500" placeholder="Type your answer here..."></textarea>
                <div class="character-count"><span id="char-count${questionNumber}">0</span>/500 characters</div>
              </div>
            `}
          </div>
          <div class="feedback" id="feedback${questionNumber}"></div>
        </div>
      `;
      
      quizContainer.insertAdjacentHTML('beforeend', questionHTML);
      
      // If it's a paragraph question, add character counter
      if (questionNumber > 15) {
        const textarea = document.getElementById(`answer${questionNumber}`);
        const countEl = document.getElementById(`char-count${questionNumber}`);
        
        textarea.addEventListener('input', function() {
          countEl.textContent = this.value.length;
          submitBtn.disabled = this.value.trim().length === 0;
        });
      } else {
        // Add event listeners for radio/checkbox inputs
        document.querySelectorAll(`#q${questionNumber} input`).forEach(input => {
          input.addEventListener('change', function() {
            // Handle styling
            if (this.type === 'radio') {
              document.querySelectorAll(`input[name="${this.name}"]`).forEach(radio => {
                radio.closest('.option').classList.remove('option-selected');
              });
              this.closest('.option').classList.add('option-selected');
            } else if (this.type === 'checkbox') {
              if (this.checked) {
                this.closest('.option').classList.add('option-selected');
              } else {
                this.closest('.option').classList.remove('option-selected');
              }
            }
            
            // Enable submit button
            submitBtn.disabled = false;
          });
        });
      }
    }
    
    function updateProgress() {
      // Update progress bar
      const progress = (quizState.currentQuestion / quizConfig.totalQuestions) * 100;
      progressBarEl.style.width = `${progress}%`;
    }
    
    // Answer Submission
    function submitAnswer() {
      const questionNumber = quizState.currentQuestion;
      const questionData = quizConfig.questions[questionNumber - 1];
      const questionEl = document.getElementById(`q${questionNumber}`);
      const feedbackEl = document.getElementById(`feedback${questionNumber}`);
      
      // Skip if no question data (for placeholder questions)
      if (!questionData && questionNumber > 3) {
        // Mock feedback for placeholder questions
        feedbackEl.textContent = "Question feedback would appear here.";
        feedbackEl.className = "feedback correct";
        feedbackEl.style.display = "block";
        
        // Mark as completed and enable next
        quizState.completed[questionNumber - 1] = true;
        nextBtn.disabled = false;
        submitBtn.disabled = true;
        
        // Record a correct answer for demo purposes
        quizState.score++;
        return;
      }
      
      let isCorrect = false;
      let userAnswer;
      
      // Process answer based on question type
      if (questionData.type === 'single') {
        // Get selected option for single-choice question
        const selectedOption = questionEl.querySelector('input[type="radio"]:checked');
        if (selectedOption) {
          userAnswer = selectedOption.value;
          isCorrect = userAnswer === questionData.correctAnswer;
        } else {
          // No answer selected
          alert("Please select an answer before submitting.");
          return;
        }
      } 
      else if (questionData.type === 'multiple') {
        // Get selected options for multiple-choice question
        const selectedOptions = Array.from(questionEl.querySelectorAll('input[type="checkbox"]:checked'))
          .map(input => input.value);
        
        userAnswer = selectedOptions;
        
        // Check if answers match exactly
        const correctAnswers = questionData.correctAnswers;
        isCorrect = selectedOptions.length === correctAnswers.length && 
                   selectedOptions.every(option => correctAnswers.includes(option));
      }
      else if (questionData.type === 'paragraph') {
        // Get text answer for paragraph question
        const textAnswer = document.getElementById(`answer${questionNumber}`).value.trim();
        userAnswer = textAnswer;
        
        if (textAnswer.length === 0) {
          alert("Please enter your answer before submitting.");
          return;
        }
        
        // For paragraph questions, we'll always show feedback but not judge correctness
        // In a real app, you might use AI or manual grading
        isCorrect = null;
      }
      
      // Store answer
      quizState.answers[questionNumber - 1] = userAnswer;
      quizState.completed[questionNumber - 1] = true;
      
      // If the answer is correct, increment score (except for paragraph questions)
      if (isCorrect === true) {
        quizState.score++;
      }
      
      // Show feedback
      if (isCorrect === null) {
        // Paragraph question feedback
        feedbackEl.innerHTML = `
          <strong>Response recorded.</strong> 
          <div class="explanation">
            Key points to include: ${questionData.keyPoints.join(', ')}
          </div>
        `;
        feedbackEl.className = "feedback correct";
      } else {
        // Multiple choice feedback
        feedbackEl.innerHTML = `
          <strong>${isCorrect ? 'Correct!' : 'Incorrect.'}</strong> 
          <div class="explanation">${questionData.explanation}</div>
        `;
        feedbackEl.className = isCorrect ? "feedback correct" : "feedback incorrect";
      }
      
      feedbackEl.style.display = "block";
      
      // Disable inputs
      questionEl.querySelectorAll('input').forEach(input => {
        input.disabled = true;
      });
      
      const textareaEl = document.getElementById(`answer${questionNumber}`);
      if (textareaEl) {
        textareaEl.disabled = true;
      }
      
      // Enable next button, disable submit button
      nextBtn.disabled = false;
      submitBtn.disabled = true;
    }
    
    // Quiz Completion
    function finishQuiz() {
      // Clear timer
      clearInterval(quizState.timer);
      
      // Calculate score
      const scorePercentage = Math.round((quizState.score / quizConfig.totalQuestions) * 100);
      const isPassing = scorePercentage >= quizConfig.passingScore;
      
      // Calculate time taken
      const timeTaken = quizConfig.timeLimit - quizState.timeRemaining;
      const minutes = Math.floor(timeTaken / 60);
      const seconds = timeTaken % 60;
      const timeString = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
      
      // Update results display
      document.getElementById('score-percentage').textContent = `${scorePercentage}%`;
      document.getElementById('score-points').textContent = `${quizState.score}/${quizConfig.totalQuestions}`;
      document.getElementById('score-time').textContent = timeString;
      document.getElementById('score-result').textContent = isPassing ? 'PASS' : 'FAIL';
      document.getElementById('score-result').style.color = isPassing ? 'var(--success)' : 'var(--danger)';
      
      // Hide quiz, show results
      quizContainer.style.display = 'none';
      resultsContainer.style.display = 'block';
      
      // Generate feedback content (would be more comprehensive in a real application)
      generateFeedbackContent();
    }
    
    function generateFeedbackContent() {
      // In a real application, you would generate detailed feedback for each question
      // For this demo, we'll just create placeholders for the first 3 questions
      
      let feedbackHTML = '';
      
      for (let i = 0; i < 3; i++) {
        const questionNumber = i + 1;
        const questionData = quizConfig.questions[i];
        let feedbackContent = '';
        
        if (questionData.type === 'single') {
          feedbackContent = `
            <div class="feedback-answer">
              Your answer: ${quizState.answers[i] || 'Not answered'}
              <br>
              Correct answer: ${questionData.correctAnswer}
            </div>
          `;
        } else if (questionData.type === 'multiple') {
          feedbackContent = `
            <div class="feedback-answer">
              Your answer: ${quizState.answers[i] ? quizState.answers[i].join(', ') : 'Not answered'}
              <br>
              Correct answer: ${questionData.correctAnswers.join(', ')}
            </div>
          `;
        } else if (questionData.type === 'paragraph') {
          feedbackContent = `
            <div class="feedback-answer">
              Your answer: ${quizState.answers[i] ? quizState.answers[i].substring(0, 100) + '...' : 'Not answered'}
              <br>
              Sample response: ${questionData.sampleAnswer.substring(0, 100) + '...'}
            </div>
          `;
        }
        
        const isCorrect = questionData.type === 'paragraph' ? null : 
                         (quizState.answers[i] === questionData.correctAnswer || 
                          (Array.isArray(quizState.answers[i]) && 
                           Array.isArray(questionData.correctAnswers) && 
                           quizState.answers[i].length === questionData.correctAnswers.length && 
                           quizState.answers[i].every(a => questionData.correctAnswers.includes(a))));
        
        const feedbackClass = isCorrect === null ? '' : (isCorrect ? 'feedback-correct' : 'feedback-incorrect');
        
        feedbackHTML += `
          <div class="feedback-item">
            <div class="feedback-question">${questionNumber}. ${document.querySelector(`#q${questionNumber} .question`).textContent.substring(3)}</div>
            ${feedbackContent}
            <div class="feedback-explanation ${feedbackClass}">
              ${questionData.explanation}
            </div>
          </div>
        `;
      }
      
      // Add placeholder for the rest of the questions
      feedbackHTML += `
        <div class="feedback-item">
          <div class="feedback-question">Additional question feedback would appear here...</div>
        </div>
      `;
      
      feedbackSection.innerHTML = `
        <h3 class="feedback-header">Question Review</h3>
        ${feedbackHTML}
      `;
    }
    
    function toggleReview() {
      const isVisible = feedbackSection.style.display === 'block';
      feedbackSection.style.display = isVisible ? 'none' : 'block';
      reviewBtn.textContent = isVisible ? 'Review Answers' : 'Hide Review';
    }
    
    function retakeQuiz() {
      // Reset quiz state
      quizState = {
        currentQuestion: 1,
        timeRemaining: quizConfig.timeLimit,
        timer: null,
        answers: Array(quizConfig.totalQuestions).fill(null),
        completed: Array(quizConfig.totalQuestions).fill(false),
        score: 0
      };
      
      // Reset UI
      document.querySelectorAll('.feedback').forEach(el => {
        el.style.display = 'none';
        el.className = 'feedback';
      });
      
      document.querySelectorAll('input').forEach(input => {
        input.disabled = false;
        input.checked = false;
      });
      
      document.querySelectorAll('.option').forEach(option => {
        option.classList.remove('option-selected');
      });
      
      document.querySelectorAll('.paragraph-answer').forEach(textarea => {
        textarea.disabled = false;
        textarea.value = '';
      });
      
      document.querySelectorAll('.character-count span').forEach(span => {
        span.textContent = '0';
      });
      
      // Show quiz, hide results
      quizContainer.style.display = 'block';
      resultsContainer.style.display = 'none';
      
      // Show first question
      showQuestion(1);
      
      // Reset progress
      updateProgress();
      
      // Start timer
      startTimer();
      
      // Reset button states
      prevBtn.disabled = true;
      nextBtn.disabled = true;
      submitBtn.disabled = true;
    }
    
    function logout() {
      // Clear any session data
      sessionStorage.removeItem('loggedIn');
      // Redirect to login page
      window.location.href = 'index.html';
    }
    
    // Initialize when page loads
    document.addEventListener('DOMContentLoaded', function() {
      // Check login status
      if (!sessionStorage.getItem('loggedIn')) {
        window.location.href = 'index.html';
        return;
      }
      
      initQuiz();
    });
  </script>
</body>
</html>